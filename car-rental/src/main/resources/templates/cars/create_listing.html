<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <!-- ƒê√É S·ª¨A: Di chuy·ªÉn v√†o ƒë√¢y -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o b√†i ƒëƒÉng thu√™ xe</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css"/>
    <link th:href="@{/css/create-listing.css}" rel="stylesheet"/>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-car me-2"></i> T·∫°o b√†i ƒëƒÉng thu√™ xe</h1>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i> <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <form th:action="@{/cars/create-listing}" th:object="${listingForm}" method="post" class="needs-validation" novalidate>
            <input type="hidden" th:field="*{vehicleId}"/>
            
            <div class="row g-3">
                <div class="col-12">
                    <p><strong>Xe:</strong> <span th:text="${car.make + ' ' + car.model + ' (' + car.year + ')'}"></span></p>
                </div>

                <!-- Ti√™u ƒë·ªÅ -->
                <div class="col-12">
                    <label for="title" class="form-label"><i class="fas fa-heading me-1"></i> Ti√™u ƒë·ªÅ</label>
                    <input type="text" class="form-control" id="title" th:field="*{title}" required>
                    <div class="invalid-feedback" th:errors="*{title}"></div>
                </div>

                <!-- M√¥ t·∫£ -->
                <div class="col-12">
                    <label for="description" class="form-label"><i class="fas fa-comment me-1"></i> M√¥ t·∫£</label>
                    <textarea class="form-control" id="description" th:field="*{description}" rows="4"></textarea>
                    <div class="invalid-feedback" th:errors="*{description}"></div>
                </div>

                <!-- Gi√° & Km -->
                <div class="col-md-6">
                    <label for="price24hCents" class="form-label"><i class="fas fa-dollar-sign me-1"></i> Gi√° thu√™ 24h (cents)</label>
                    <input type="number" class="form-control" id="price24hCents" th:field="*{price24hCents}" required min="1">
                    <div class="invalid-feedback" th:errors="*{price24hCents}"></div>
                </div>
                <div class="col-md-6">
                    <label for="kmLimit24h" class="form-label"><i class="fas fa-road me-1"></i> Gi·ªõi h·∫°n km/24h</label>
                    <input type="number" class="form-control" id="kmLimit24h" th:field="*{kmLimit24h}" required min="1">
                    <div class="invalid-feedback" th:errors="*{kmLimit24h}"></div>
                </div>

                <!-- ƒê·∫∑t ngay & Ch√≠nh s√°ch h·ªßy -->
                <div class="col-md-6">
                    <label for="instantBook" class="form-label"><i class="fas fa-bolt me-1"></i> ƒê·∫∑t ngay</label>
                    <select class="form-select" id="instantBook" th:field="*{instantBook}" required>
                        <option value="true">C√≥</option>
                        <option value="false">Kh√¥ng</option>
                    </select>
                    <div class="invalid-feedback" th:errors="*{instantBook}"></div>
                </div>
                <div class="col-md-6">
                    <label for="cancellationPolicy" class="form-label"><i class="fas fa-ban me-1"></i> Ch√≠nh s√°ch h·ªßy</label>
                    <select class="form-select" id="cancellationPolicy" th:field="*{cancellationPolicy}" required>
                        <option value="STRICT">Nghi√™m ng·∫∑t</option>
                        <option value="MODERATE">V·ª´a ph·∫£i</option>
                        <option value="FLEX">Linh ho·∫°t</option>
                    </select>
                    <div class="invalid-feedback" th:errors="*{cancellationPolicy}"></div>
                </div>

                <!-- Tr·∫°ng th√°i -->
                <div class="col-md-6">
                    <label for="status" class="form-label"><i class="fas fa-info-circle me-1"></i> Tr·∫°ng th√°i</label>
                    <select class="form-select" id="status" th:field="*{status}" required>
                        <option value="PENDING_REVIEW">Ch·ªù duy·ªát</option>
                        <option value="ACTIVE">Ho·∫°t ƒë·ªông</option>
                        <option value="DRAFT">Nh√°p</option>
                        <option value="SUSPENDED">T·∫°m d·ª´ng</option>
                        <option value="ARCHIVED">L∆∞u tr·ªØ</option>
                    </select>
                    <div class="invalid-feedback" th:errors="*{status}"></div>
                </div>

                <!-- B·∫£n ƒë·ªì -->
                <!-- üî• FIX: B·ªé READONLY + STYLE ƒê·∫∏P -->
<div class="col-md-12">
    <label class="form-label"><i class="fas fa-map-marker-alt me-1"></i> V·ªã tr√≠ xe (Click/Drag marker)</label>
    <div id="map" style="height: 400px; border: 2px solid #dee2e6; border-radius: 8px;"></div>
</div>

<div class="row mt-3">
    <div class="col-md-4">
        <label for="homeCity" class="form-label"><i class="fas fa-city me-1"></i> Th√†nh ph·ªë</label>
        <input type="text" class="form-control form-control-lg" id="homeCity" th:field="*{homeCity}" required>
        <div class="invalid-feedback" th:errors="*{homeCity}"></div>
    </div>
    <div class="col-md-4">
        <label for="longitude" class="form-label"><i class="fas fa-globe me-1"></i> Kinh ƒë·ªô</label>
        <input type="number" step="any" class="form-control form-control-lg bg-light" 
               id="longitude" th:field="*{longitude}" required>
        <div class="invalid-feedback" th:errors="*{longitude}"></div>
    </div>
    <div class="col-md-4">
        <label for="latitude" class="form-label"><i class="fas fa-globe me-1"></i> Vƒ© ƒë·ªô</label>
        <input type="number" step="any" class="form-control form-control-lg bg-light" 
               id="latitude" th:field="*{latitude}" required>
        <div class="invalid-feedback" th:errors="*{latitude}"></div>
    </div>
</div>
            
            <div class="btn-group-action">
                <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-plus me-2"></i> T·∫°o b√†i ƒëƒÉng</button>
                <a th:href="@{/cars/list}" class="btn btn-secondary btn-lg"><i class="fas fa-arrow-left me-2"></i> Quay l·∫°i</a>
            </div>
        </form>
    </div>

    <!-- Scripts -->
    <!-- Scripts ‚Äì ƒê·∫¢M B·∫¢O TH·ª® T·ª∞ ƒê√öNG -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Leaflet tr∆∞·ªõc -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
        crossorigin="" defer></script>

<!-- GeoSearch sau -->
<script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.umd.js" defer></script>

<!-- JS c·ªßa b·∫°n cu·ªëi c√πng -->
<script th:src="@{/js/create-listing-map.js}" defer></script>
</body>
</html>